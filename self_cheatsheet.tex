% Copyright (c) 2016 Bystroushaak

% Permission is hereby granted, free of charge, to any person
% obtaining a copy of this software and associated documentation
% files (the "Software"), to deal in the Software without
% restriction, including without limitation the rights to use,
% copy, modify, merge, publish, distribute, sublicense, and/or sell
% copies of the Software, and to permit persons to whom the
% Software is furnished to do so, subject to the following
% conditions:

% The above copyright notice and this permission notice shall be
% included in all copies or substantial portions of the Software.

% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
% EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
% OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
% NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
% HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
% WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
% FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
% OTHER DEALINGS IN THE SOFTWARE.

% Inspired by http://tex.stackexchange.com/questions/99765/document-class-for-reference-cards
\documentclass[10pt]{article}
\usepackage{fixltx2e}
\usepackage[orthodox,l2tabu,abort]{nag}
\usepackage{textcomp}
\usepackage{hyperref}

% Page layout
\usepackage[landscape,margin=0.5in]{geometry}
\usepackage{multicol}

% Title area
\usepackage{titling} % Allows for use of date, author, etc. after \maketitle
% Ref: http://tex.stackexchange.com/questions/3988/titlesec-versus-titling-mangling-thetitle
\let\oldtitle\title
\renewcommand{\title}[1]{\oldtitle{#1}\newcommand{\mythetitle}{#1}}
\renewcommand{\maketitle}{
    {\begin{center}\Large \mythetitle\end{center}}
}

% Document divisions
\usepackage{titlesec}
\setcounter{secnumdepth}{0}
\titlespacing{\section}{0pt}{0pt}{0pt}
\titlespacing{\subsection}{0pt}{5pt}{0pt}
\setlength{\parskip}{2pt}

\usepackage{nopageno} % To keep \section from resetting page style
\setlength{\parindent}{0pt} % disabling indentation by default

% Lists
\usepackage{enumitem} % for consistent formatting of lists
\newlist{ttdesc}{description}{1}
\setlist[ttdesc]{font=\ttfamily,noitemsep}
\usepackage{calc} % for \widthof

\usepackage{lipsum}

% Metadata definition
\title{Selflang cheat sheet}
\author{Bystroushaak}
\date{2016}

\pdfinfo {
    /Author   (\theauthor)
    /Title    (\thetitle)
    /Subject  (\thetitle)
    /Keywords (Self, SelfLang, programming language, programming)
}


% Set listing
% https://en.wikibooks.org/wiki/LaTeX/Source_Code_Listings
\usepackage{listings}
\usepackage{pxfonts}

\lstset{
    basicstyle=\ttfamily,
    keywordstyle=\bfseries,
    showstringspaces=false,
    breaklines=false,
    breakatwhitespace=false,
    columns=fullflexible,
}


% Content =====================================================================
\begin{document}
\begin{multicols*}{3}
\maketitle

\section{Object syntax}
An \textit{object} consists from (possibly empty) set of \textit{slots} and (optionally) \textit{code}.

Slots behave as key-value lookup table for data or objects. \textit{Code} is a sequenece of \textit{expressions} (\textit{message sends} and \textit{literals}) separated by dots, and evaluated in order.

Syntax is straightforward:

\begin{lstlisting}
(| slot1. slot2 | 'code')
\end{lstlisting}

for object with \textit{slots} and \textit{code}, or

\begin{lstlisting}
(| | 'code') or ('code')
\end{lstlisting}

for object with \textit{code}, but no \textit{slots}, or

\begin{lstlisting}
(| slot1. slot2. slotN |)
\end{lstlisting}

for object with \textit{slots}, but no \textit{code}, or

\begin{lstlisting}
(| |) or ()
\end{lstlisting}

for empty object.




\subsection{Slot assignments}
Slots can be assigned at the definition, either read only using \texttt{=} operator:

\begin{lstlisting}
(| slot = 1 |)
\end{lstlisting}

or rewritable using \texttt{<-} operator: % TODO: operator, really?

\begin{lstlisting}
(| slot <- 1 |)
\end{lstlisting}




\subsection{Message sends}

\textit{Message sends} are evaluated from left to right. Object is on the left, messages on the right. Messages can be without arguments:

\begin{lstlisting}
obj message
\end{lstlisting}

(to the \textit{obj} send a \textit{message}), or with arguments:

\begin{lstlisting}
obj message: argument
\end{lstlisting}

(to the \textit{obj} send a \textit{message} with \textit{argument} as value).

\textit{Block objects} take by default message \texttt{value}, which evaluates the code and returns the value. If the \textit{block object} takes (multiple) parameters, they may be supplied using \texttt{value:\ With:} message pattern:

\begin{lstlisting}
obj value: x With: y .. With: z
\end{lstlisting}

Notice the uppercase first letters in \texttt{With:} message, which tells the Self interpreter, that this is still part of one message send, with multiple arguments.




\subsection{Special slots}
Every object has automatically created slot named \texttt{self}, pointing to object itself. Unlike other languages, \texttt{self} may be ommited, in \textit{message sends}, so

\begin{lstlisting}
self xe
\end{lstlisting}

is same thing as

\begin{lstlisting}
xe
\end{lstlisting}

Every object may also contain \texttt{parent*} slot, to which the lookups unresolved in \texttt{self} is delegated. This implements the inheritance.




\subsection{Block objects \textit{(closures)}}
\textit{Block objects} share syntax with \textit{objects}, except that square brackts are used instead of round:

\begin{lstlisting}
[| slot1. slot2 | 'code']
\end{lstlisting}

\textit{Block objects} works as closures, which means, that \texttt{self} slot is not present. Unresolved lookups are delegated via \texttt{*parent} to namespace surrounding the \textit{block object} at the time of creation.

Another difference is support of \textit{non-local return statement} using \texttt{\^} preceding the returned value. This returns the value not just from the closure, but also from the enclosing namespace.

\begin{lstlisting}
(|
    x = 6.
    non_zero = (
        x >  ifTrue: [ ^ 'ok' ]
             False: [ ^ 'nope' ]
    )
|)
\end{lstlisting}

\^{} doesn't just return from the closure in \texttt{[]}, but also from the surrounding \textit{method object}.




\section{Control sequences}
\subsection{If condition}

As usual in Smalltalk-like languages, \textit{if condition} is implemented as everything else by sending messages, in this case to boolean-like objects:

\vspace*{0.2cm}
\begin{tabular}{ p{70pt} p{140pt} l l }
Command & Description \\ \hline
\begin{lstlisting}
obj ifTrue: b1
    False: b2
\end{lstlisting}
&\vspace*{0.1cm} \textit{b1} is executed, when \textit{obj} evaluates to \texttt{true}.
If not, (optional) \textit{b2} block is used. \\
\hline


\end{tabular}





% Footer
\vfill \hrule\smallskip
{\small This card may be freely distributed under
the terms of the MIT licence ---
Copyleft \textcopyleft\ \thedate{} by \href{http://kitakitsune.org}{\theauthor}.

\url{https://github.com/Bystroushaak/SelfCheatSheet}
}

\end{multicols*}
\end{document}
